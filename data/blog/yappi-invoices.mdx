---
title: 'Yappy Invoices'
date: '2018-08-15'
tags: ['Home', 'Mobile', 'Prepago', 'Postpago', 'Híbrido', 'Métodos de pago', 'Invoices']
jiras: [18071]
draft: false
summary: 'Pago de facturas con yappy se encuentra activo actualmente en PA'
---

<TOCInline toc={props.toc} exclude="Overview" toHeading={2} asDisclosure />

## CURLS

POST

`curl --location --request POST 'http://oneapp.dev.pa/api/v2.0/payment/home/invoices/billingaccounts/27849436/purchaseordersasync?_format=json' \
--header 'sec-ch-ua: "Chromium";v="104", " Not A;Brand";v="99", "Google Chrome";v="104"' \
--header 'sec-ch-ua-mobile: ?0' \
--header 'client-version: 1.0.0' \
--header 'Authorization: Bearer eyJraWQiOiJiRU5PSlNJRjBYWTJiYWd4TnFYMDBiZnMydFZZRzAxVXlUSDhpT3lrVlBRPSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJmYjY3NWMyOS1kYWJhLTRjYTItODY1OS02NDY1MWRlNGNiMzMiLCJnTmFtZSI6IkRheWFuYSIsInBob25lViI6ImZhbHNlIiwiaGFzUHdkIjoidHJ1ZSIsImlzcyI6Imh0dHBzOlwvXC9jb2duaXRvLWlkcC51cy1lYXN0LTEuYW1hem9uYXdzLmNvbVwvdXMtZWFzdC0xX2tRN2tDS1RtbyIsImFsbEFjYyI6ImZhbHNlIiwiY29nbml0bzp1c2VybmFtZSI6ImZiNjc1YzI5LWRhYmEtNGNhMi04NjU5LTY0NjUxZGU0Y2IzMyIsImFMIjoiW3tcImN0cnlcIjpcInB5XCIsXCJjYUlkXCI6XCI5ODQyNTc0Q0lQWVwiLFwic3NJZFwiOlwiY3JtXCIsXCJwcnRUeXBlXCI6XCJpbmRpdmlkdWFsXCIsXCJiYUxcIjpbe1wiYmFJZFwiOlwiNEI5MjE4OTYxXCIsXCJwc0lkXCI6XCIxMjAwODQ5OTIwXCIsXCJidVwiOlwiaG9tZVwiLFwiYnRcIjpcImh5YnJpZFwiLFwicHJcIjpcImd1ZXN0XCIsXCJzTFwiOlt7XCJzSWRcIjpcIjEyMDA4NDk5MDNcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIDE1IG1icHNcIn0se1wic0lkXCI6XCIxMjAwODQ5OTA0XCIsXCJzdFwiOlwiZmlicmEgdGlnbyBidXNpbmVzcyAyMDAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MDVcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIDQwMCBtYnBzXCJ9LHtcInNJZFwiOlwiMTIwMDg0OTkwNlwiLFwic3RcIjpcImZpYnJhIHRpZ28gYnVzaW5lc3MgNDAwIG1icHNcIn0se1wic0lkXCI6XCIxMjAwODQ5OTA3XCIsXCJzdFwiOlwiZmlicmEgdGlnbyBidXNpbmVzcyA1MDAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MDhcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIHZwbiAxNTAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MTBcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIHZwbiAyMDAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MTFcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIHZwbiAyMDAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MTJcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIHZwbiA0MDAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MTNcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIHZwbiAxIGdicHNcIn0se1wic0lkXCI6XCIxMjAwODQ5OTE1XCIsXCJzdFwiOlwiZmlicmEgdGlnbyBidXNpbmVzcyA1MDAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MThcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIHZwbiA2MCBtYnBzXCJ9LHtcInNJZFwiOlwiMTIwMDg0OTkxOVwiLFwic3RcIjpcImZpYnJhIHRpZ28gYnVzaW5lc3MgdnBuIDMwIG1icHNcIn0se1wic0lkXCI6XCIxMjAwODQ5OTIwXCIsXCJzdFwiOlwiZmlicmEgdGlnbyBidXNpbmVzcyB2cG4gMTUgbWJwc1wifV19XX0se1wiY3RyeVwiOlwicHlcIixcImNhSWRcIjpcIjQ5NTQ3MzdDSVBZXCIsXCJzc0lkXCI6XCJjcm1cIixcInBydFR5cGVcIjpcImluZGl2aWR1YWxcIn0se1wiY3RyeVwiOlwiYm9cIixcImNhSWRcIjpcIlNJR0EtNjc2NzY1NDMxMVwiLFwic3NJZFwiOlwic2lnYVwiLFwicHJ0VHlwZVwiOlwiaW5kaXZpZHVhbFwiLFwiYmFMXCI6W3tcImJhSWRcIjpcIjE3NDg3NDlcIixcInBzSWRcIjpcIjU5MTc3MDEwOTUzXCIsXCJidVwiOlwiY29udmVyZ2VudFwiLFwiYnRcIjpcInBvc3RwYWlkXCIsXCJwclwiOlwiZ3Vlc3RcIixcInNMXCI6W3tcInNJZFwiOlwiNzcwMTA5NTNcIixcInN0XCI6XCJoeWJyaWRcIixcImFJZFwiOlwiNzcwMTA5NTNcIixcInBJZFwiOlwiNTIyOFwiLFwibXNpc2RuTFwiOlt7XCJtc2lzZG5cIjpcIjU5MTc3MDEwOTUzXCJ9XX1dfV19LHtcImN0cnlcIjpcImJvXCIsXCJjYUlkXCI6XCIxNTM0ODkxN1wiLFwic3NJZFwiOlwicXZhbnRlbFwiLFwicHJ0VHlwZVwiOlwiaW5kaXZpZHVhbFwiLFwiYmFMXCI6W3tcImJhSWRcIjpcIjEwMDk4NDk4XCIsXCJwc0lkXCI6XCI1OTE2MjA1NDM3NFwiLFwiYnVcIjpcIm1vYmlsZVwiLFwiYnRcIjpcInByZXBhaWRcIixcInByXCI6XCJndWVzdFwiLFwic0xcIjpbe1wic0lkXCI6XCI2MjA1NDM3NFwiLFwic3RcIjpcInByZXBhaWRcIixcImFJZFwiOlwiNjIwNTQzNzRcIixcInBJZFwiOlwiMTg0XCIsXCJtc2lzZG5MXCI6W3tcIm1zaXNkblwiOlwiNTkxNjIwNTQzNzRcIn1dfV19XX0se1wiY3RyeVwiOlwiYm9cIixcImNhSWRcIjpcIjY1MDI0ODQwXCIsXCJzc0lkXCI6XCJxdmFudGVsXCIsXCJwcnRUeXBlXCI6XCJpbmRpdmlkdWFsXCIsXCJiYUxcIjpbe1wiYmFJZFwiOlwiNjUwMjc5NjFcIixcInBzSWRcIjpcIjU5MTc2MTIzOTQxXCIsXCJidVwiOlwibW9iaWxlXCIsXCJidFwiOlwicHJlcGFpZFwiLFwicHJcIjpcImd1ZXN0XCIsXCJzTFwiOlt7XCJzSWRcIjpcIjU5MTc2MTIzOTQxXCIsXCJzdFwiOlwicHJlcGFpZFwiLFwiYUlkXCI6XCI1OTE3NjEyMzk0MVwiLFwicElkXCI6XCJQT19UaWdvX1ByZV9QYWdvX0luaWNpYWxcIixcIm1zaXNkbkxcIjpbe1wibXNpc2RuXCI6XCI1OTE3NjEyMzk0MVwifV19XX1dfV0iLCJ1dWlkIjoiNTZiZmIzZDAtZmE1Yy0xMWU5LWFhODktZDNhMmY5MWNiMjMyIiwiY3VzdG9tOlVVSUQiOiI1NmJmYjNkMC1mYTVjLTExZTktYWE4OS1kM2EyZjkxY2IyMzIiLCJhdWQiOiI2cTczM2dzaTNrZ2RjbGQ5bmNpYnRuNmVicCIsImh5YkxvZ2luIjoiZmFsc2UiLCJmTmFtZSI6IlNhbGNlZG8iLCJldmVudF9pZCI6IjkyNzAxMjY5LWU4MTYtNDFlNi1hNmJjLWFmYzU3NDZkYjUxMiIsInRva2VuX3VzZSI6ImlkIiwic2VjTG9naW4iOiJ0cnVlIiwiYXV0aF90aW1lIjoxNjYyMTI4NzI3LCJleHAiOjE2NjIxMzIzMjcsImVtYWlsViI6InRydWUiLCJpYXQiOjE2NjIxMjg3MjcsImVtYWlsIjoiZGF5YW5hLnNhbGNlZG9AYml0c2FtZXJpY2FzLmNvbSJ9.atcmNvbhj9_VjO8jYfu3uas9m2qaTxNrQVyEv9K2QCN9Qr1eI6qROcLA_Ke5SstpjupGkebY23iAGwV9fBf7nt3KChNd7xZf9xHyTnCwaLQYQcX-cpuedEadYujeGpb1B9EDI9XuajLDh2k8icCUAWS3-TynKXOJppSxX_nd4O8XuNmGrR5XKMa7EoPhGwZTchIth7i-_2AtJyYWhvgHkgeObgunzfXiizpSbtkAHiSegNuhTpx-KUh0MmMuer5y4fSJiTFu0ehYp4CQOrKxYDelBRBhJk0ghpX6B41_Fy-n8FzIYOM8ZebLOept_ieiyZA2_I06we4UBvZ-jVOi9w' \
--header 'Content-Type: application/json' \
--header 'Accept: application/json, text/plain, */*' \
--header 'Referer: https://oneapp-stg-pa.tigocloud.net/' \
--header 'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36' \
--header 'sec-ch-ua-platform: "Windows"' \
--header 'Cookie: SESS2cc132784e05185aacdddb72d1ab88fb=ziYgwzkv5js8c9QeLPt567FbFTngWXf0JnDv5BD-nSc; SESSION=1663611420' \
--data-raw '{"amount":1,"isPartialPayment":true,"paymentMethod":"Async_Yappy","deviceId":"9b5b39c8-87fb-4720-b81b-4ba0bcc304b2-chrome"}'`

PUT

`curl --location -g --request PUT 'http://oneapp.dev.pa/api/v2.0/payment/{{businessUnit}}/invoices/{{idType}}/{{id}}/purchaseordersasync/{{purchaseorderId}}?_format=json&userAgent=1' \
--header 'Authorization: Bearer eyJraWQiOiJiRU5PSlNJRjBYWTJiYWd4TnFYMDBiZnMydFZZRzAxVXlUSDhpT3lrVlBRPSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJmYjY3NWMyOS1kYWJhLTRjYTItODY1OS02NDY1MWRlNGNiMzMiLCJnTmFtZSI6IkRheWFuYSIsInBob25lViI6ImZhbHNlIiwiaGFzUHdkIjoidHJ1ZSIsImlzcyI6Imh0dHBzOlwvXC9jb2duaXRvLWlkcC51cy1lYXN0LTEuYW1hem9uYXdzLmNvbVwvdXMtZWFzdC0xX2tRN2tDS1RtbyIsImFsbEFjYyI6ImZhbHNlIiwiY29nbml0bzp1c2VybmFtZSI6ImZiNjc1YzI5LWRhYmEtNGNhMi04NjU5LTY0NjUxZGU0Y2IzMyIsImFMIjoiW3tcImN0cnlcIjpcInB5XCIsXCJjYUlkXCI6XCI5ODQyNTc0Q0lQWVwiLFwic3NJZFwiOlwiY3JtXCIsXCJwcnRUeXBlXCI6XCJpbmRpdmlkdWFsXCIsXCJiYUxcIjpbe1wiYmFJZFwiOlwiNEI5MjE4OTYxXCIsXCJwc0lkXCI6XCIxMjAwODQ5OTIwXCIsXCJidVwiOlwiaG9tZVwiLFwiYnRcIjpcImh5YnJpZFwiLFwicHJcIjpcImd1ZXN0XCIsXCJzTFwiOlt7XCJzSWRcIjpcIjEyMDA4NDk5MDNcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIDE1IG1icHNcIn0se1wic0lkXCI6XCIxMjAwODQ5OTA0XCIsXCJzdFwiOlwiZmlicmEgdGlnbyBidXNpbmVzcyAyMDAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MDVcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIDQwMCBtYnBzXCJ9LHtcInNJZFwiOlwiMTIwMDg0OTkwNlwiLFwic3RcIjpcImZpYnJhIHRpZ28gYnVzaW5lc3MgNDAwIG1icHNcIn0se1wic0lkXCI6XCIxMjAwODQ5OTA3XCIsXCJzdFwiOlwiZmlicmEgdGlnbyBidXNpbmVzcyA1MDAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MDhcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIHZwbiAxNTAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MTBcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIHZwbiAyMDAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MTFcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIHZwbiAyMDAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MTJcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIHZwbiA0MDAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MTNcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIHZwbiAxIGdicHNcIn0se1wic0lkXCI6XCIxMjAwODQ5OTE1XCIsXCJzdFwiOlwiZmlicmEgdGlnbyBidXNpbmVzcyA1MDAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MThcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIHZwbiA2MCBtYnBzXCJ9LHtcInNJZFwiOlwiMTIwMDg0OTkxOVwiLFwic3RcIjpcImZpYnJhIHRpZ28gYnVzaW5lc3MgdnBuIDMwIG1icHNcIn0se1wic0lkXCI6XCIxMjAwODQ5OTIwXCIsXCJzdFwiOlwiZmlicmEgdGlnbyBidXNpbmVzcyB2cG4gMTUgbWJwc1wifV19XX0se1wiY3RyeVwiOlwicHlcIixcImNhSWRcIjpcIjQ5NTQ3MzdDSVBZXCIsXCJzc0lkXCI6XCJjcm1cIixcInBydFR5cGVcIjpcImluZGl2aWR1YWxcIn0se1wiY3RyeVwiOlwiYm9cIixcImNhSWRcIjpcIlNJR0EtNjc2NzY1NDMxMVwiLFwic3NJZFwiOlwic2lnYVwiLFwicHJ0VHlwZVwiOlwiaW5kaXZpZHVhbFwiLFwiYmFMXCI6W3tcImJhSWRcIjpcIjE3NDg3NDlcIixcInBzSWRcIjpcIjU5MTc3MDEwOTUzXCIsXCJidVwiOlwiY29udmVyZ2VudFwiLFwiYnRcIjpcInBvc3RwYWlkXCIsXCJwclwiOlwiZ3Vlc3RcIixcInNMXCI6W3tcInNJZFwiOlwiNzcwMTA5NTNcIixcInN0XCI6XCJoeWJyaWRcIixcImFJZFwiOlwiNzcwMTA5NTNcIixcInBJZFwiOlwiNTIyOFwiLFwibXNpc2RuTFwiOlt7XCJtc2lzZG5cIjpcIjU5MTc3MDEwOTUzXCJ9XX1dfV19LHtcImN0cnlcIjpcImJvXCIsXCJjYUlkXCI6XCIxNTM0ODkxN1wiLFwic3NJZFwiOlwicXZhbnRlbFwiLFwicHJ0VHlwZVwiOlwiaW5kaXZpZHVhbFwiLFwiYmFMXCI6W3tcImJhSWRcIjpcIjEwMDk4NDk4XCIsXCJwc0lkXCI6XCI1OTE2MjA1NDM3NFwiLFwiYnVcIjpcIm1vYmlsZVwiLFwiYnRcIjpcInByZXBhaWRcIixcInByXCI6XCJndWVzdFwiLFwic0xcIjpbe1wic0lkXCI6XCI2MjA1NDM3NFwiLFwic3RcIjpcInByZXBhaWRcIixcImFJZFwiOlwiNjIwNTQzNzRcIixcInBJZFwiOlwiMTg0XCIsXCJtc2lzZG5MXCI6W3tcIm1zaXNkblwiOlwiNTkxNjIwNTQzNzRcIn1dfV19XX0se1wiY3RyeVwiOlwiYm9cIixcImNhSWRcIjpcIjY1MDI0ODQwXCIsXCJzc0lkXCI6XCJxdmFudGVsXCIsXCJwcnRUeXBlXCI6XCJpbmRpdmlkdWFsXCIsXCJiYUxcIjpbe1wiYmFJZFwiOlwiNjUwMjc5NjFcIixcInBzSWRcIjpcIjU5MTc2MTIzOTQxXCIsXCJidVwiOlwibW9iaWxlXCIsXCJidFwiOlwicHJlcGFpZFwiLFwicHJcIjpcImd1ZXN0XCIsXCJzTFwiOlt7XCJzSWRcIjpcIjU5MTc2MTIzOTQxXCIsXCJzdFwiOlwicHJlcGFpZFwiLFwiYUlkXCI6XCI1OTE3NjEyMzk0MVwiLFwicElkXCI6XCJQT19UaWdvX1ByZV9QYWdvX0luaWNpYWxcIixcIm1zaXNkbkxcIjpbe1wibXNpc2RuXCI6XCI1OTE3NjEyMzk0MVwifV19XX1dfV0iLCJ1dWlkIjoiNTZiZmIzZDAtZmE1Yy0xMWU5LWFhODktZDNhMmY5MWNiMjMyIiwiY3VzdG9tOlVVSUQiOiI1NmJmYjNkMC1mYTVjLTExZTktYWE4OS1kM2EyZjkxY2IyMzIiLCJhdWQiOiI2cTczM2dzaTNrZ2RjbGQ5bmNpYnRuNmVicCIsImh5YkxvZ2luIjoiZmFsc2UiLCJmTmFtZSI6IlNhbGNlZG8iLCJldmVudF9pZCI6IjkyNzAxMjY5LWU4MTYtNDFlNi1hNmJjLWFmYzU3NDZkYjUxMiIsInRva2VuX3VzZSI6ImlkIiwic2VjTG9naW4iOiJ0cnVlIiwiYXV0aF90aW1lIjoxNjYyMTI4NzI3LCJleHAiOjE2NjIxMzIzMjcsImVtYWlsViI6InRydWUiLCJpYXQiOjE2NjIxMjg3MjcsImVtYWlsIjoiZGF5YW5hLnNhbGNlZG9AYml0c2FtZXJpY2FzLmNvbSJ9.atcmNvbhj9_VjO8jYfu3uas9m2qaTxNrQVyEv9K2QCN9Qr1eI6qROcLA_Ke5SstpjupGkebY23iAGwV9fBf7nt3KChNd7xZf9xHyTnCwaLQYQcX-cpuedEadYujeGpb1B9EDI9XuajLDh2k8icCUAWS3-TynKXOJppSxX_nd4O8XuNmGrR5XKMa7EoPhGwZTchIth7i-_2AtJyYWhvgHkgeObgunzfXiizpSbtkAHiSegNuhTpx-KUh0MmMuer5y4fSJiTFu0ehYp4CQOrKxYDelBRBhJk0ghpX6B41_Fy-n8FzIYOM8ZebLOept_ieiyZA2_I06we4UBvZ-jVOi9w' \
--header 'Content-Type: application/json' \
--header 'Cookie: SESS2cc132784e05185aacdddb72d1ab88fb=ziYgwzkv5js8c9QeLPt567FbFTngWXf0JnDv5BD-nSc; SESSION=1663611420' \
--data-raw '{
    "paymentMethod": "Async_Yappy",
    "email": "ximena.duenas@bitsamericas.com",
    "customerName": "Datos de prueba",
    "isPartialPayment": "true",
    "numberSubscription": "{{targetMsisdn}}"
}'`

STATUS

`curl --location -g --request GET 'http://oneapp.dev.pa/api/v2.0/payment/{{businessUnit}}/invoices/{{idType}}/{{id}}/purchaseorders/{{purchaseorderId}}/status?force=true&_format=json' \
--header 'Authorization: Bearer eyJraWQiOiJiRU5PSlNJRjBYWTJiYWd4TnFYMDBiZnMydFZZRzAxVXlUSDhpT3lrVlBRPSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJmYjY3NWMyOS1kYWJhLTRjYTItODY1OS02NDY1MWRlNGNiMzMiLCJnTmFtZSI6IkRheWFuYSIsInBob25lViI6ImZhbHNlIiwiaGFzUHdkIjoidHJ1ZSIsImlzcyI6Imh0dHBzOlwvXC9jb2duaXRvLWlkcC51cy1lYXN0LTEuYW1hem9uYXdzLmNvbVwvdXMtZWFzdC0xX2tRN2tDS1RtbyIsImFsbEFjYyI6ImZhbHNlIiwiY29nbml0bzp1c2VybmFtZSI6ImZiNjc1YzI5LWRhYmEtNGNhMi04NjU5LTY0NjUxZGU0Y2IzMyIsImFMIjoiW3tcImN0cnlcIjpcInB5XCIsXCJjYUlkXCI6XCI5ODQyNTc0Q0lQWVwiLFwic3NJZFwiOlwiY3JtXCIsXCJwcnRUeXBlXCI6XCJpbmRpdmlkdWFsXCIsXCJiYUxcIjpbe1wiYmFJZFwiOlwiNEI5MjE4OTYxXCIsXCJwc0lkXCI6XCIxMjAwODQ5OTIwXCIsXCJidVwiOlwiaG9tZVwiLFwiYnRcIjpcImh5YnJpZFwiLFwicHJcIjpcImd1ZXN0XCIsXCJzTFwiOlt7XCJzSWRcIjpcIjEyMDA4NDk5MDNcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIDE1IG1icHNcIn0se1wic0lkXCI6XCIxMjAwODQ5OTA0XCIsXCJzdFwiOlwiZmlicmEgdGlnbyBidXNpbmVzcyAyMDAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MDVcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIDQwMCBtYnBzXCJ9LHtcInNJZFwiOlwiMTIwMDg0OTkwNlwiLFwic3RcIjpcImZpYnJhIHRpZ28gYnVzaW5lc3MgNDAwIG1icHNcIn0se1wic0lkXCI6XCIxMjAwODQ5OTA3XCIsXCJzdFwiOlwiZmlicmEgdGlnbyBidXNpbmVzcyA1MDAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MDhcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIHZwbiAxNTAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MTBcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIHZwbiAyMDAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MTFcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIHZwbiAyMDAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MTJcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIHZwbiA0MDAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MTNcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIHZwbiAxIGdicHNcIn0se1wic0lkXCI6XCIxMjAwODQ5OTE1XCIsXCJzdFwiOlwiZmlicmEgdGlnbyBidXNpbmVzcyA1MDAgbWJwc1wifSx7XCJzSWRcIjpcIjEyMDA4NDk5MThcIixcInN0XCI6XCJmaWJyYSB0aWdvIGJ1c2luZXNzIHZwbiA2MCBtYnBzXCJ9LHtcInNJZFwiOlwiMTIwMDg0OTkxOVwiLFwic3RcIjpcImZpYnJhIHRpZ28gYnVzaW5lc3MgdnBuIDMwIG1icHNcIn0se1wic0lkXCI6XCIxMjAwODQ5OTIwXCIsXCJzdFwiOlwiZmlicmEgdGlnbyBidXNpbmVzcyB2cG4gMTUgbWJwc1wifV19XX0se1wiY3RyeVwiOlwicHlcIixcImNhSWRcIjpcIjQ5NTQ3MzdDSVBZXCIsXCJzc0lkXCI6XCJjcm1cIixcInBydFR5cGVcIjpcImluZGl2aWR1YWxcIn0se1wiY3RyeVwiOlwiYm9cIixcImNhSWRcIjpcIlNJR0EtNjc2NzY1NDMxMVwiLFwic3NJZFwiOlwic2lnYVwiLFwicHJ0VHlwZVwiOlwiaW5kaXZpZHVhbFwiLFwiYmFMXCI6W3tcImJhSWRcIjpcIjE3NDg3NDlcIixcInBzSWRcIjpcIjU5MTc3MDEwOTUzXCIsXCJidVwiOlwiY29udmVyZ2VudFwiLFwiYnRcIjpcInBvc3RwYWlkXCIsXCJwclwiOlwiZ3Vlc3RcIixcInNMXCI6W3tcInNJZFwiOlwiNzcwMTA5NTNcIixcInN0XCI6XCJoeWJyaWRcIixcImFJZFwiOlwiNzcwMTA5NTNcIixcInBJZFwiOlwiNTIyOFwiLFwibXNpc2RuTFwiOlt7XCJtc2lzZG5cIjpcIjU5MTc3MDEwOTUzXCJ9XX1dfV19LHtcImN0cnlcIjpcImJvXCIsXCJjYUlkXCI6XCIxNTM0ODkxN1wiLFwic3NJZFwiOlwicXZhbnRlbFwiLFwicHJ0VHlwZVwiOlwiaW5kaXZpZHVhbFwiLFwiYmFMXCI6W3tcImJhSWRcIjpcIjEwMDk4NDk4XCIsXCJwc0lkXCI6XCI1OTE2MjA1NDM3NFwiLFwiYnVcIjpcIm1vYmlsZVwiLFwiYnRcIjpcInByZXBhaWRcIixcInByXCI6XCJndWVzdFwiLFwic0xcIjpbe1wic0lkXCI6XCI2MjA1NDM3NFwiLFwic3RcIjpcInByZXBhaWRcIixcImFJZFwiOlwiNjIwNTQzNzRcIixcInBJZFwiOlwiMTg0XCIsXCJtc2lzZG5MXCI6W3tcIm1zaXNkblwiOlwiNTkxNjIwNTQzNzRcIn1dfV19XX0se1wiY3RyeVwiOlwiYm9cIixcImNhSWRcIjpcIjY1MDI0ODQwXCIsXCJzc0lkXCI6XCJxdmFudGVsXCIsXCJwcnRUeXBlXCI6XCJpbmRpdmlkdWFsXCIsXCJiYUxcIjpbe1wiYmFJZFwiOlwiNjUwMjc5NjFcIixcInBzSWRcIjpcIjU5MTc2MTIzOTQxXCIsXCJidVwiOlwibW9iaWxlXCIsXCJidFwiOlwicHJlcGFpZFwiLFwicHJcIjpcImd1ZXN0XCIsXCJzTFwiOlt7XCJzSWRcIjpcIjU5MTc2MTIzOTQxXCIsXCJzdFwiOlwicHJlcGFpZFwiLFwiYUlkXCI6XCI1OTE3NjEyMzk0MVwiLFwicElkXCI6XCJQT19UaWdvX1ByZV9QYWdvX0luaWNpYWxcIixcIm1zaXNkbkxcIjpbe1wibXNpc2RuXCI6XCI1OTE3NjEyMzk0MVwifV19XX1dfV0iLCJ1dWlkIjoiNTZiZmIzZDAtZmE1Yy0xMWU5LWFhODktZDNhMmY5MWNiMjMyIiwiY3VzdG9tOlVVSUQiOiI1NmJmYjNkMC1mYTVjLTExZTktYWE4OS1kM2EyZjkxY2IyMzIiLCJhdWQiOiI2cTczM2dzaTNrZ2RjbGQ5bmNpYnRuNmVicCIsImh5YkxvZ2luIjoiZmFsc2UiLCJmTmFtZSI6IlNhbGNlZG8iLCJldmVudF9pZCI6IjkyNzAxMjY5LWU4MTYtNDFlNi1hNmJjLWFmYzU3NDZkYjUxMiIsInRva2VuX3VzZSI6ImlkIiwic2VjTG9naW4iOiJ0cnVlIiwiYXV0aF90aW1lIjoxNjYyMTI4NzI3LCJleHAiOjE2NjIxMzIzMjcsImVtYWlsViI6InRydWUiLCJpYXQiOjE2NjIxMjg3MjcsImVtYWlsIjoiZGF5YW5hLnNhbGNlZG9AYml0c2FtZXJpY2FzLmNvbSJ9.atcmNvbhj9_VjO8jYfu3uas9m2qaTxNrQVyEv9K2QCN9Qr1eI6qROcLA_Ke5SstpjupGkebY23iAGwV9fBf7nt3KChNd7xZf9xHyTnCwaLQYQcX-cpuedEadYujeGpb1B9EDI9XuajLDh2k8icCUAWS3-TynKXOJppSxX_nd4O8XuNmGrR5XKMa7EoPhGwZTchIth7i-_2AtJyYWhvgHkgeObgunzfXiizpSbtkAHiSegNuhTpx-KUh0MmMuer5y4fSJiTFu0ehYp4CQOrKxYDelBRBhJk0ghpX6B41_Fy-n8FzIYOM8ZebLOept_ieiyZA2_I06we4UBvZ-jVOi9w' \
--header 'Content-Type: application/json' \
--header 'Cookie: SESS2cc132784e05185aacdddb72d1ab88fb=ziYgwzkv5js8c9QeLPt567FbFTngWXf0JnDv5BD-nSc; SESSION=1663611420'`

## Módulos que se deben activar

1\. OneApp Convergent Payment Gateway Yappy

2\. Oneapp Convergent Payment Gateway Yappy Invoices

## Bloques que se requieren guardar

```
#### https://{{enviroment}}/admin/config/oneapp/adf_block_config

1\. https://{{enviroment}}/admin/config/oneapp/adf_block_config/oneapp_convergent_payment_gateway_yappy_invoices_v2_0_generate_purchaseorders_block

2\. https://{{enviroment}}/admin/config/oneapp/adf_block_config/oneapp_convergent_payment_gateway_invoices_v2_0_purchase_status_yappy_block

```

## Rest Resources que se deben activar y dar permisos

1\.
| Oneapp Payment Gateway Yappy Invoices API callbacks Rest Resource | `/api/v2.0/paymentgateway/callbacks/{businessUnit}/yappy/invoices/orders/{purchaseOrderId}/{typePage}`: PUT |

2\.
| ONEAPP Convergent Payment Gateway Invoices Generate Purchaseorders Async Rest Resource V2_0 | `/api/v2.0/payment/{businessUnit}/invoices/{idType}/{id}/purchaseordersasync/{purchaseorderId}`: PUT\
`/api/v2.0/payment/{businessUnit}/invoices/{idType}/{id}/purchaseordersasync`: POST |

3\.
| ONEAPP Convergent Payment Gateway Invoices Purchase Status Rest Resource v2_0 | `/api/v2.0/payment/{businessUnit}/invoices/{idType}/{id}/purchaseorders/{purchaseorderId}/status`: GET |

## Formularios que se requieren configurar y guardar

```
1\. https://{{enviroment}}/admin/config/oneapp/config/mobile/payment_gateway_yappy_invoices

2\. https://{{enviroment}}/admin/config/oneapp/config/home/payment_gateway_yappy_invoices
```

## Flujo UX APIS

Flujo

1\. Se selecciona el metodo de pago,

2\. Se introduce el numero yappy que va a pagar

3\. Se redirecciona a url yappy para efectuar el pago

4\. Luego de efectuado el pago, vuelve a Oneapp y muestra el estado de la transacción.

Secuencia del flujo yappy topups

\`\`\`mermaid

sequenceDiagram

Orderdetails->> POST: Orden inicializada

POST-->>PUT: Creación body y envío de orden a paymentgateway

Callback Payment->> Drupal: Entrada de callback a drupal y escritura de respuesta de orden en bd (aprobada o rechazada).

Callback Fullfilment->> Drupal: Si Callback Payment es aprobado, entrada de segundo callback a drupal y escritura de respuesta de orden en bd (aprobada o rechazada).

Status-->> Drupal: Pregunta estado de la transacción y si no la encuentra actualizada fuerza llamado a paymentgateway para conocer el estado. \
.

\`\`\`

## Datos de interés

**1. Errores más comunes PUT**

|Cód | Causas |

|409 |Orden duplicada|

|400 | Error body enviado a payment |

**2. Mientras exista una transaccion en estado inicializado o order_in_progress** en un **periodo de tiempo** configurable en el formulario de configuracion de yappy topups, se devolvera el **mismo identificador de la orden** ya creada para evitar **duplicados** innecesarios.
